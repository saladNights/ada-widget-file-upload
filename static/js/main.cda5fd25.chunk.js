(this["webpackJsonpada-widget-file-upload"]=this["webpackJsonpada-widget-file-upload"]||[]).push([[0],{2:function(e,t,a){e.exports={wrapper:"App_wrapper__RCHjb",fileUploadBtn:"App_fileUploadBtn__1KiJb",loadingSpinner:"App_loadingSpinner__mDfBX",disabledFileUploadBtn:"App_disabledFileUploadBtn__12Cq9 App_fileUploadBtn__1KiJb",loadingFileUploadBtn:"App_loadingFileUploadBtn__1ws4A App_disabledFileUploadBtn__12Cq9 App_fileUploadBtn__1KiJb",btnText:"App_btnText__-PJRh",errorsWrapper:"App_errorsWrapper__3VnvC",error:"App_error__1LS0k"}},21:function(e,t,a){e.exports=a(46)},26:function(e,t,a){},46:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(16),s=a.n(r),o=(a(26),a(6)),l=a(3),c=a.n(l),d=a(5),p=a(17),u=a(18),v=a(20),m=a(19),f=a(4),_=a.n(f),h="https://hidden-everglades-39585.herokuapp.com",g=function(e){return e.split(".").pop()},A=a(2),b=a.n(A),y=new(a(45)),w=function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={isLoading:!1,isActive:!1,s3AccessKeyId:"",s3SecretAccessKey:"",bucketName:"",errorMsgs:{initialized:"ADA SDK could not be initialized"},errors:[],validationErrors:[],maxFileSize:10,allowedFileExtensions:void 0,uploadPath:""},e.isFileValid=function(t){var a=e.state,n=a.maxFileSize,i=a.allowedFileExtensions,r=[];if(t.size>1048576*n&&r.push("maxFileSize"),i){var s=g(t.name);i.includes(s)||r.push("allowedFileExtensions")}return r.length?(e.setState({validationErrors:r}),!1):(e.setState({validationErrors:[]}),!0)},e.onChangeHandler=function(t){var a=e.state,n=a.isLoading,i=a.isActive;if(t.preventDefault(),!n&&i&&y.widgetIsActive){var r=t.currentTarget.files&&t.currentTarget.files[0];r&&e.isFileValid(r)&&e.uploadFile(r)}},e.createGetUrl=function(){var t=Object(d.a)(c.a.mark((function t(a,n){var i,r,s,o,l,d,p,u,v;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.state,r=i.s3AccessKeyId,s=i.s3SecretAccessKey,o=i.bucketName,l=i.uploadPath,d={params:{BucketName:o,Key:"".concat(l,"/").concat(a),s3Key:n},headers:{"X-S3-P-Key":r,"X-S3-S-Key":s}},p="",t.next=5,_.a.get("".concat(h,"/presigned-url-get-object"),d);case 5:return u=t.sent,(v=u.data).url&&(p=v.url),t.abrupt("return",p);case 9:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.uploadFile=function(){var t=Object(d.a)(c.a.mark((function t(a){var n,i,r,s,o,l,d,p,u,v,m,f,g;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.state,i=n.s3AccessKeyId,r=n.s3SecretAccessKey,s=n.bucketName,o=n.uploadPath,l=a.name,d=a.type,p={params:{BucketName:s,Key:"".concat(o,"/").concat(l),ContentType:d},headers:{"Content-Type":d,"X-S3-P-Key":i,"X-S3-S-Key":r}},e.setState({isLoading:!0}),t.prev=5,t.next=8,_.a.get("".concat(h,"/presigned-url-put-object"),p);case 8:return u=t.sent,v=u.data,t.prev=10,t.next=13,_.a.put(v.url,a,p);case 13:return m=t.sent,f=m.headers,t.next=17,e.createGetUrl(l,f["x-amz-version-id"]);case 17:g=t.sent,e.sendDataToADA(a,f["x-amz-version-id"],g),e.setState({isLoading:!1}),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(10),console.error(t.t0);case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(5),console.error(t.t1);case 30:case"end":return t.stop()}}),t,null,[[5,27],[10,22]])})));return function(e){return t.apply(this,arguments)}}(),e.sendDataToADA=function(t,a,n){y.widgetIsActive&&y.sendUserData({fileName:t.name,fileType:t.type,fileSize:t.size,s3Key:a,presignedDownloadUrl:n},(function(){e.setState({isActive:!1})}))},e}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.state.errorMsgs;try{y.init((function(a){var n,i,r,s,l,c,d,p,u,v,m,f;"WIDGET_INITIALIZED"===a.type&&e.setState({isActive:!0,s3AccessKeyId:null===(n=a.metaData)||void 0===n?void 0:n.s3_access_key_id,s3SecretAccessKey:null===(i=a.metaData)||void 0===i?void 0:i.s3_secret_access_key,bucketName:null===(r=a.metaData)||void 0===r?void 0:r.bucket_name,uploadPath:(null===(s=a.metaData)||void 0===s?void 0:s.upload_path)||(null===(l=a.metaData)||void 0===l?void 0:l.chatterToken)||"uploads",maxFileSize:+(null===(c=a.metaData)||void 0===c?void 0:c.max_file_size)||10,allowedFileExtensions:null===(d=a.metaData)||void 0===d||null===(p=d.allowed_file_extensions)||void 0===p?void 0:p.split(", "),errorMsgs:Object(o.a)(Object(o.a)({},t),{},{maxFileSize:(null===(u=a.metaData)||void 0===u?void 0:u.max_file_size_msg)||"File size should be less than ".concat(+(null===(v=a.metaData)||void 0===v?void 0:v.max_file_size)||10," Mb"),allowedFileExtensions:(null===(m=a.metaData)||void 0===m?void 0:m.allowed_file_extensions_msg)||"File extension should be one of the list: ".concat(null===(f=a.metaData)||void 0===f?void 0:f.allowed_file_extensions)})})}))}catch(a){this.setState({errors:["initialized"]})}}},{key:"componentDidUpdate",value:function(e,t){!y.widgetIsActive&&t.isActive&&this.setState({isActive:!1})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,a=e.isActive,n=e.errorMsgs,r=e.errors,s=e.validationErrors,o=b.a.disabledFileUploadBtn;return a&&(o=b.a.fileUploadBtn),t&&(o=b.a.loadingFileUploadBtn),i.a.createElement("div",{className:b.a.wrapper},i.a.createElement("label",{htmlFor:"file",className:o},i.a.createElement("input",{type:"file",name:"file",id:"file",onChange:this.onChangeHandler,disabled:t||!a}),i.a.createElement("span",{className:b.a.btnText},"Upload File"),t&&i.a.createElement("div",{className:b.a.loadingSpinner})),i.a.createElement("div",{className:b.a.errorsWrapper},r.map((function(e){return i.a.createElement("div",{key:e,className:b.a.error},n[e])})),s.map((function(e){return i.a.createElement("div",{key:e,className:b.a.error},n[e])}))))}}]),a}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[21,1,2]]]);
//# sourceMappingURL=main.cda5fd25.chunk.js.map